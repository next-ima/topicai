## Project Name

**topicai**

---

## Project Objective

Build a **Python-based headless application** that:

* Lets new **topics be created via an API call**, stored in a MongoDB database.
* Periodically enriches these topics by calling the **OpenAI API** to produce up-to-date summaries.
* Stores each update as a separate record tied to the original topic, with a timestamp, enabling a **history of topic insights over time**.

---

## Data model in MongoDB

### Collections & Documents

#### `topics` collection

| Field      | Type        | Description                                                  |
| ---------- | ----------- | ------------------------------------------------------------ |
| `_id`      | `ObjectId`  | Unique MongoDB document ID.                                  |
| `keywords` | `list[str]` | Keywords describing the topic. Example: `["war in ukraine"]` |

#### `topicupdates` collection

| Field        | Type       | Description                                |
| ------------ | ---------- | ------------------------------------------ |
| `_id`        | `ObjectId` | Unique ID.                                 |
| `topic_id`   | `ObjectId` | Reference to `_id` of a `topics` document. |
| `summary`    | `str`      | Summary text generated by OpenAI.          |
| `score`      | `double`   | Scoring of the change calculated by OpenAI.|
| `updatetime` | `datetime` | When this summary was generated.           |

**Hint for junior dev:**

* Use `pymongo` to work with MongoDB.
* For references, store the `ObjectId` directly.

---

## Workflow overview

```
[API Call] --> Create Topic (keywords)
               |
          [MongoDB: topics]

[Scheduler / Script]
    |
[Load topics needing update]
    |
[Call OpenAI -> generate summary]
    |
[Save to topicupdates with timestamp + reference to topic]
    |
[MongoDB: topicupdates]
```

---

## Functionality to implement

### **API for new topics**

* A simple HTTP endpoint (can use **FastAPI** for speed) that accepts:

  ```json
  {
    "keywords": ["war in ukraine", "nato"]
  }
  ```
* Creates a new `Topic` document in MongoDB.

### **Content update process**

* Loads all topics from `topics` collection.
* For each topic, builds a prompt using its keywords.
* Calls OpenAI to get a summary of the latest developments.
* Calls OpenAI to compare the received summary with existing in mongodb
  * prompt: "Compare the following two texts separated with character '|' and compute similarity score for them ranging from 0, as not similar at all to 1 exactly the same."
* Creates a `TopicUpdate` document with:

  * `topic_id` referencing the topic
  * `summary` text
  * `updatetime` set to `datetime.utcnow()`

### **No runtime OpenAI calls for end-users**

* Users querying topics later will just get the pre-generated summaries from `topicupdates`.

---

## Technology stack

| Purpose        | Tech                                             |
| -------------- | ------------------------------------------------ |
| Language       | Python 3.11+                                     |
| API server     | **FastAPI** (lightweight, auto docs via Swagger) |
| Database       | **MongoDB** (via `pymongo`)                      |
| AI Integration | **OpenAI Python SDK**                            |
| Config         | `.env` + `python-dotenv`                         |
| Logging        | Python `logging` module                          |

---

## Example Python interfaces / structure

### Abstract interfaces

```python
from abc import ABC, abstractmethod
from typing import List
from bson import ObjectId

class ContentUpdater(ABC):
    @abstractmethod
    def update_content(self, keywords: List[str]) -> str:
        """Generate summary based on keywords."""
        pass

class TopicRepository(ABC):
    @abstractmethod
    def create_topic(self, keywords: List[str]) -> ObjectId:
        """Insert a new topic and return its ID."""
        pass

    @abstractmethod
    def get_all_topics(self) -> List[dict]:
        """Return all topics for processing."""
        pass

    @abstractmethod
    def save_topic_update(self, topic_id: ObjectId, summary: str) -> None:
        """Save generated summary as a new topic update."""
        pass
```

---

## Example file structure

```
project-root/
│
├── main.py               # Entry point for updating topics
├── api.py                # FastAPI server for creating new topics
├── interfaces.py         # Abstract classes
├── openai_updater.py     # Calls OpenAI
├── mongo_repository.py   # Talks to MongoDB
├── requirements.txt
├── .env                  # OPENAI_API_KEY + MONGO_URI
└── logs/
    └── app.log
```

---

## Developer workflow

1. **Install packages**

   ```bash
   pip install fastapi uvicorn pymongo openai python-dotenv
   ```

2. **Run API to create new topics**

   ```bash
   uvicorn api:app --reload
   ```

   Then POST to `/topics`:

   ```json
   {
     "keywords": ["war in ukraine"]
   }
   ```

3. **Run enrichment process manually for now**

   ```bash
   python main.py
   ```

---

## Hints for the junior developer

Use `pymongo` like this:

```python
from pymongo import MongoClient
from bson import ObjectId

client = MongoClient(MONGO_URI)
db = client['topicdb']
topics = db['topics']
updates = db['topicupdates']

topic_id = topics.insert_one({"keywords": ["war in ukraine"]}).inserted_id
updates.insert_one({"topic_id": topic_id, "summary": "Latest details...", "updatetime": datetime.utcnow()})
```

With **FastAPI**, this is how your endpoint could look:

```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class TopicRequest(BaseModel):
    keywords: list[str]

@app.post("/topics")
def create_topic(req: TopicRequest):
    topic_id = topic_repository.create_topic(req.keywords)
    return {"topic_id": str(topic_id)}
```

Always validate that `topic_id` is a valid `ObjectId`.

In `main.py`:

* Loop over `repo.get_all_topics()`
* For each, call `updater.update_content(keywords)`
* Then call `repo.save_topic_update(topic_id, summary)`

---

## Deliverables

| Deliverable                  | Description                                       |
| ---------------------------- | ------------------------------------------------- |
| `api.py`                     | FastAPI server for creating topics                |
| `main.py`                    | Script to update summaries                        |
| MongoDB schemas              | Topics & topicupdates collections                 |
| Interfaces & implementations | Modular Python design                             |
| Example logs                 | Show processing of multiple topics                |
| README.md                    | How to set up MongoDB, .env, run API, run updater |

---

## Future extensions

✅ Add filtering by date or keyword to the API.
✅ Track previous updates & deltas over time.
✅ Add scheduling via cron or Celery to auto-run `main.py`.
